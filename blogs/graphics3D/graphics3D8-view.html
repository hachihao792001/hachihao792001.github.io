<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/blogcontent.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="graphics3D.css">

    <script src="/js/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <title>Graphics Engine 3D</title>
</head>

<body data-graphics3D-id="graphics3D8">
    <main>
        <div class="container-fluid ps-0">
            <div class="row">
                <div class="col-12 col-lg-2 sidebar pb-0 pe-0">
                    <!--load from sidebar.html-->
                </div>

                <div class="blog-content col-12 col-lg-10">
                    <div id="graphics3D-nav-top"></div>
                    <h1>View matrix</h1>
                    
                    Ta s·∫Ω v·ªÅ l·∫°i v·ªõi ma tr·∫≠n sau m·ªôt blog kh·ªßng ho·∫£ng v·ªõi to√°n 4D ü•µ Blog n√†y kh√¥ng n·∫±m k·∫ø ti·∫øp blog model (ƒë·ªß b·ªô Model View Project matrix) l√† c√≥ l√≠ do c·∫£.<br/><br/>

                    T·ª´ ƒë·∫ßu t·ªõi gi·ªù ta ch·ªâ "ƒë√∫ng m·ªôt ch·ªó nh√¨n", render ƒë√∫ng 1 g√≥c nh√¨n ·ªü 1 v·ªã tr√≠ c·ªë ƒë·ªãnh (0, 0, 0), n·∫øu nh∆∞ ta mu·ªën "xoay ch·ªó kh√°c" hay "ƒëi ch·ªó kh√°c" th√¨ sao? ƒê√≥ ch√≠nh
                    l√† c√¥ng d·ª•ng c·ªßa View matrix, l√† ƒëi·ªÅu khi·ªÉn "camera" v√† hi·ªÉn th·ªã ƒë√∫ng nh·ªØng g√¨ m√† "camera" th·∫•y.<br/><br/>

                    ƒê·∫ßu ti√™n, ta ph·∫£i hi·ªÉu l√† View matrix kh√¥ng di chuy·ªÉn hay xoay camera, m√† th·∫≠t ra l√† ƒëang di chuy·ªÉn v√† xoay c·∫£ th·∫ø gi·ªõi quanh camera, camera v·∫´n lu√¥n ·ªü
                    (0, 0, 0) v√† lu√¥n nh√¨n theo tr·ª•c Z (n·∫øu l√† h·ªá t·ªça ƒë·ªô tay tr√°i). V√≠ d·ª• ta mu·ªën camera ·ªü v·ªã tr√≠ (0, 2, -5) v√† euler angles c·ªßa n√≥ l√† (30, -50, 40), ta ph·∫£i
                    di chuy·ªÉn to√†n b·ªô object (0, -2, 5) v√† xoay to√†n b·ªô object quanh g·ªëc t·ªça ƒë·ªô (ch·ª© ko ph·∫£i quanh t√¢m c·ªßa ch√≠nh n√≥) (-30, 50, -40) (xoay theo th·ª© t·ª± \(z \rightarrow
                    y \rightarrow x\), ng∆∞·ª£c v·ªõi l√∫c xoay object).<br/><br/>
                    
                    Theo v√≠ d·ª• ƒë√≥, view matrix ch·ªâ l√† k·∫øt qu·∫£ nh√¢n c·ªßa 3 rotation matrix v√† 1 translation matrix, g·ªçi v·ªã tr√≠ camera
                    l√† \(t\) v√† euler angles c·ªßa camera l√† \((\alpha, \beta, \gamma)\), view matrix s·∫Ω c√≥ d·∫°ng nh∆∞ sau:
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos{(-\alpha)} & sin{(-\alpha)} & 0\\
                        0 & -\sin{(-\alpha)} & \cos{(-\alpha)} & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}

                        \begin{pmatrix}
                        cos{(-\beta)} & 0 & -sin{(-\beta)} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{(-\beta)} & 0 & \cos{(-\beta)} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        
                        \begin{pmatrix}
                        cos{(-\gamma)} & sin{(-\gamma)} & 0 & 0\\
                        -\sin{(-\gamma)} & \cos{(-\gamma)} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}

                        \begin{pmatrix}
                        1 & 0 & 0 & -t_{x}\\
                        0 & 1 & 0 & -t_{y}\\
                        0 & 0 & 1 & -t_{z}\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$
                    $$
                        =
                        \begin{pmatrix}
                        \cos\beta\cos\gamma &
                        -\cos\beta\sin\gamma &
                        \sin\beta &
                        -(\cos\beta\cos\gamma\,t_x
                        -\cos\beta\sin\gamma\,t_y
                        +\sin\beta\,t_z)
                        \\
                        \sin\alpha\sin\beta\cos\gamma + \cos\alpha\sin\gamma &
                        -\sin\alpha\sin\beta\sin\gamma + \cos\alpha\cos\gamma &
                        -\sin\alpha\cos\beta &
                        -( (\sin\alpha\sin\beta\cos\gamma + \cos\alpha\sin\gamma)t_x
                        +(-\sin\alpha\sin\beta\sin\gamma + \cos\alpha\cos\gamma)t_y
                        -\sin\alpha\cos\beta\,t_z )
                        \\
                        -\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma &
                        \cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma &
                        \cos\alpha\cos\beta &
                        -( (-\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma)t_x
                        +(\cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma)t_y
                        +\cos\alpha\cos\beta\,t_z )
                        \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$
                    <div align="center" style="font-size: 14px"><i>M√¨nh d√πng ChatGPT ƒë·ªÉ ra ƒë∆∞·ª£c k·∫øt qu·∫£ tr√™n v√¨ nh√¢n b·∫±ng tay ch·∫Øc t·ªõi mai ü•µ</i></div><br/>
                    N·∫øu b·∫°n th·∫•y r·ªëi v√¨ ·ªü tr√™n m√¨nh n√≥i l√† theo th·ª© t·ª± \(z \rightarrow y \rightarrow x\) nh∆∞ng l√∫c nh√¢n l·∫°i l√† ng∆∞·ª£c l·∫°i, ƒë√≥ l√† v√¨ ta ƒëang applied ma tr·∫≠n t·ª´ ph·∫£i sang
                    tr√°i, xem l·∫°i code c·ªßa <a href="graphics3D5-model.html">blog 5</a>, ma tr·∫≠n n·∫±m b√™n tr√°i vector, v√† ma tr·∫≠n n√†o ƒë∆∞·ª£c l√†m tr∆∞·ªõc s·∫Ω n·∫±m b√™n ph·∫£i.<br/><br/>
                    N·∫øu b·∫°n mu·ªën, b·∫°n c√≥ th·ªÉ x√†i lu√¥n ma tr·∫≠n b√πi nh√πi ƒë√≥ v√†o trong engine üòÇ, v√† n√≥ s·∫Ω ch·∫°y ƒë√∫ng. Nh∆∞ng trong ƒë·ªì h·ªça 3D th√¨ kh√¥ng ai bi·ªÉu di·ªÖn view matrix v·ªõi euler angles c·∫£, m√†
                    thay v√†o ƒë√≥ ng∆∞·ªùi ta s·∫Ω d√πng 3 vector ƒë∆°n v·ªã ƒë·∫°i di·ªán cho tr·ª•c local c·ªßa camera, g·ªçi l√† forward (\(\vec{f}\)), up (\(\vec{u}\)) v√† right (\(\vec{r}\)).
                    Th·∫≠t ra b·∫°n c√≥ th·ªÉ chuy·ªÉn ma tr·∫≠n tr√™n th√†nh ma tr·∫≠n ch·ªâ c√≥ forward, up, right n·∫øu b·∫°n ƒë·ªß ki√™n nh·∫´n ƒë·ªÉ l√†m l∆∞·ª£ng gi√°c v·ªõi kh√¥ng gian 3D.<br/><br/>
                    C√°ch t·ªët nh·∫•t l√† t·ª´ forward, up, right l√†m l√™n, ta s·∫Ω xoay 3 vector ƒë√≥ l·∫ßn l∆∞·ª£t theo t·ª´ng tr·ª•c xem n√≥ th√†nh g√¨, b√¢y gi·ªù th√¨ ta l·∫°i xoay n√≥ nh∆∞ xoay object (\(x \rightarrow y \rightarrow z\)),
                    v√¨ ta c≈©ng c√≥ th·ªÉ xem camera nh∆∞ m·ªôt object.<br/><br/>
                    ƒê·∫ßu ti√™n ta c√≥:
                    $$
                    \begin{eqnarray}
                    r = (1, 0, 0)\\
                    u = (0, 1, 0)\\
                    f = (0, 0, 1)
                    \end{eqnarray}
                    $$
                    Xoay theo tr·ª•c \(x\), l√† nh√¢n cho x rotation matrix:
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos\alpha & sin\alpha & 0\\
                        0 & -\sin\alpha & \cos\alpha & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        1\\
                        0\\
                        0\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        1\\
                        0\\
                        0\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos\alpha & sin\alpha & 0\\
                        0 & -\sin\alpha & \cos\alpha & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        1\\
                        0\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        0\\
                        \cos{\alpha}\\
                        -\sin{\alpha}\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos\alpha & \sin\alpha & 0\\
                        0 & -\sin\alpha & \cos\alpha & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        0\\
                        1\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        0\\
                        \sin\alpha\\
                        \cos\alpha\\
                        0
                        \end{pmatrix}
                    $$
                    Xoay theo tr·ª•c \(y\):
                    $$
                        \begin{pmatrix}
                        cos{\beta} & 0 & -\sin{\beta} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{\beta} & 0 & \cos{\beta} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        1\\
                        0\\
                        0\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \cos{\beta}\\
                        0\\
                        \sin{\beta}\\
                        0\\
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\beta} & 0 & -\sin{\beta} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{\beta} & 0 & \cos{\beta} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        \cos{\alpha}\\
                        -\sin{\alpha}\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \sin\alpha\sin\beta\\
                        \cos\alpha\\
                        -sin\alpha\cos\beta\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\beta} & 0 & -\sin{\beta} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{\beta} & 0 & \cos{\beta} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        \sin\alpha\\
                        \cos\alpha\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        -\cos\alpha\sin\beta\\
                        \sin\alpha\\
                        \cos\alpha\cos\beta\\
                        0
                        \end{pmatrix}
                    $$
                    Xoay theo tr·ª•c \(z\):
                    $$
                        \begin{pmatrix}
                        cos{\gamma} & \sin{\gamma} & 0 & 0\\
                        -\sin{\gamma} & \cos{\gamma} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        \cos{\beta}\\
                        0\\
                        \sin{\beta}\\
                        0\\
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \cos{\beta}\cos{\gamma}\\
                        -\cos{\beta}\sin{\gamma}\\
                        \sin{\beta}\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\gamma} & \sin{\gamma} & 0 & 0\\
                        -\sin{\gamma} & \cos{\gamma} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        \sin{\beta}\sin{\alpha}\\
                        \cos{\alpha}\\
                        -\sin{\alpha}\cos{\beta}\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \sin{\alpha}\sin{\beta}\cos{\gamma} + \cos{\alpha}\sin{\gamma}\\
                        -\sin{\alpha}\sin{\beta}\sin{\gamma} + \cos{\alpha}\cos{\gamma}\\
                        -\sin{\alpha}\cos{\beta}\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\gamma} & \sin{\gamma} & 0 & 0\\
                        -\sin{\gamma} & \cos{\gamma} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        -\cos\alpha\sin{\beta}\\
                        \sin\alpha\\
                        \cos\alpha\cos\beta\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        -\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma\\
                        \cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma\\
                        \cos\alpha\cos\beta\\
                        0
                        \end{pmatrix}
                    $$
                    Nh∆∞ v·∫≠y:
                    $$
                    r' = \begin{pmatrix}
                        \cos{\beta}\cos{\gamma}\\
                        -\cos{\beta}\sin{\gamma}\\
                        \sin{\beta}
                        \end{pmatrix}
                    $$
                    $$
                    u' = \begin{pmatrix}
                        \sin{\alpha}\sin{\beta}\cos{\gamma} + \cos{\alpha}\sin{\gamma}\\
                        -\sin{\alpha}\sin{\beta}\sin{\gamma} + \cos{\alpha}\cos{\gamma}\\
                        -\sin{\alpha}\cos{\beta}
                        \end{pmatrix}
                    $$
                    $$
                    f' = \begin{pmatrix}
                        -\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma\\
                        \cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma\\
                        \cos\alpha\cos\beta
                        \end{pmatrix}
                    $$
                    G√°n v√†o ma tr·∫≠n b√πi nh√πi ·ªü tr√™n, th·∫ø l√† ta c√≥ view matrix m√† ta mu·ªën:
                    $$
                        \begin{pmatrix}
                        r'_x & r'_y & r'_z & -r'_x.t_x -r'_y.t_x-r'_z.t_z\\
                        u'_x & u'_y & u'_z & -u'_x.t_x -u'_y.t_x-u'_z.t_z \\
                        f'_x & f'_y & f'_z & -f'_x.t_x -f'_y.t_x-f'_z.t_z \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}=
                        \begin{pmatrix}
                        r'_x & r'_y & r'_z & -\langle r, t \rangle\\
                        u'_x & u'_y & u'_z & -\langle u, t \rangle\\
                        f'_x & f'_y & f'_z & -\langle f, t \rangle\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$
                    N·∫øu b·∫°n t√¨m google v·ªÅ View matrix, th∆∞·ªùng th√¨ ng∆∞·ªùi ta s·∫Ω nh·∫Øc t·ªõi LookAt matrix (ƒë∆°n gi·∫£n ch·ªâ l√† ma tr·∫≠n k·∫øt h·ª£p xoay v√† di chuy·ªÉn, ma tr·∫≠n n√†y c≈©ng theo
                    forward, up, right). Ngh·ªãch ƒë·∫£o ma tr·∫≠n LookAt s·∫Ω ra View matrix, th·∫≠t ra v·ªÅ b·∫£n ch·∫•t c≈©ng kh√¥ng kh√°c nh·ªØng g√¨ m√¨nh l√†m, ngh·ªãch ƒë·∫£o c·ªßa rotation matrix s·∫Ω ra
                    l·∫°i rotation matrix ƒë√≥ nh∆∞ng ƒë·ªëi d·∫•u g√≥c, ngh·ªãch ƒë·∫£o translation matrix c≈©ng ra l·∫°i ma tr·∫≠n ƒë√≥ nh∆∞ng ƒë·ªïi d·∫•u \(t\). N·∫øu b·∫°n hi·ªÉu b·∫£n ch·∫•t c·ªßa ngh·ªãch ƒë·∫£o ma tr·∫≠n
                    th√¨ hi·ªÉu theo c√°ch ƒë√≥ c≈©ng ƒë∆∞·ª£c üò≥ Ngo√†i ra khi t√¨m google b·∫°n s·∫Ω th·∫•y nhi·ªÅu phi√™n
                    b·∫£n kh√°c nhau c·ªßa View Matrix, ƒë√≥ l√† v√¨ n√≥ kh√°c nhau v·ªÅ handedness c·ªßa h·ªá t·ªça ƒë·ªô (tr√°i hay ph·∫£i) v√† vector ·ªü d·∫°ng ma tr·∫≠n l√† column hay row, v·ªõi engine m√¨nh ƒëang
                    l√†m th√¨ n√≥ l√† h·ªá t·ªça ƒë·ªô tay tr√°i (left-handed coordinate) v√† vector l√† column vector n·∫øu b·∫°n kh√¥ng nh·ªõ.<br/>
                    Nh√¨n v√†o view matrix, b·∫°n c≈©ng ph·∫ßn n√†o ƒëo√°n ƒë∆∞·ª£c n√≥ l√†m g√¨, kh·ªëi 3x3 ·ªü g√≥c tr√°i khi nh√¢n v·ªõi \(v\) n√≥ s·∫Ω ra t√≠ch c√≥ h∆∞·ªõng c·ªßa \(v\) v·ªõi \(r, u, f\), ƒë·ªìng nghƒ©a
                    "h√¨nh chi·∫øu c·ªßa \(v\) tr√™n 3 tr·ª•c m·ªõi \(r, u, f\)". V√† 3 c√°i t√≠ch v√¥ h∆∞·ªõng v·ªõi \(t\) l√† "c·ªông v√†o \(v\) m·ªôt vector \(t'\) ƒë√£ ƒë∆∞·ª£c bi·∫øn ƒë·ªïi theo tr·ª•c m·ªõi".<br/><br/>

                    C√≥ ƒë∆∞·ª£c View matrix r·ªìi, ta b·∫Øt tay v√†o code th√¥i, ta s·∫Ω l√†m lu√¥n m·ªôt h·ªá th·ªëng di chuy·ªÉn camera nh∆∞ FPS, d√πng chu·ªôt ƒë·ªÉ nh√¨n qua l·∫°i, WASD ƒë·ªÉ di chuy·ªÉn, ngo√†i ra Space
                    ƒë·ªÉ bay l√™n v√† Shift ƒë·ªÉ bay xu·ªëng. ƒê·∫ßu ti√™n ta h√£y t·∫°o m·ªôt h√†m t·∫°o View matrix t·ª´ forward, up, right v√† t:
                    <pre><code class="language-javascript">class Mat4x4 {
    ...
    static View(r, u, f, t) {
        let matrix = new Mat4x4();
        matrix.m[0][0] = r.x;
        matrix.m[0][1] = r.y;
        matrix.m[0][2] = r.z;
        matrix.m[1][0] = u.x;
        matrix.m[1][1] = u.y;
        matrix.m[1][2] = u.z;
        matrix.m[2][0] = f.x;
        matrix.m[2][1] = f.y;
        matrix.m[2][2] = f.z;
        matrix.m[0][3] = -Vector3.dot(r,t);
        matrix.m[1][3] = -Vector3.dot(u,t);
        matrix.m[2][3] = -Vector3.dot(f,t);
        matrix.m[3][3] = 1;
        return matrix;
    }
    ...
}</code></pre>
                    Sau ƒë√≥ ta s·∫Ω t·∫°o m·ªôt class ƒë·∫°i di·ªán cho camera, c√≥ thu·ªôc t√≠nh v·ªã tr√≠ v√† rotation c·ªßa camera (c≈©ng l√† m·ªôt Quaternion), t·ª´ rotation n√†y ta c√≥ th·ªÉ suy ra
                    right, up, forward b·∫•t k·ª≥ l√∫c n√†o, b·∫±ng c√°ch √°p d·ª•ng Quaternion rotation ƒë√≥ v√†o right, up, forward th·∫ø gi·ªõi. Class camera n√†y s·∫Ω ƒë·∫£m nhi·ªám lu√¥n vi·ªác x·ª≠ l√Ω input chu·ªôt v√† b√†n ph√≠m ƒë·ªÉ nh√¨n v√† di chuy·ªÉn, b√™n ngo√†i ch·ªâ c√≥ nhi·ªám v·ª• truy·ªÅn
                    th√¥ng tin input v√†o, v√† truy·ªÅn lu√¥n dt ƒë·ªÉ c·∫≠p nh·∫≠t v·ªã tr√≠ theo t·ªëc ƒë·ªô th·ªëng nh·∫•t. H√†m updateRotation s·∫Ω nh·∫≠n v√†o tham s·ªë l√† s·ª± thay ƒë·ªïi c·ªßa v·ªã tr√≠ con chu·ªôt so v·ªõi
                    frame tr∆∞·ªõc (s·∫Ω n√≥i r√µ h∆°n ·ªü ph·∫ßn d∆∞·ªõi): (mouseMovementX, mouseMovementY). S·ª≠ d·ª•ng mouseMovementX ƒë·ªÉ quay theo tr·ª•c up (qua tr√°i qua ph·∫£i), chu·ªôt qua ph·∫£i th√¨ ta mu·ªën
                    xoay camera theo c√πng chi·ªÅu kim ƒë·ªìng, tuy nhi√™n engine ta l√†m ph√©p xoay theo ng∆∞·ª£c chi·ªÅu kim ƒë·ªìng h·ªì, cho n√™n ta ph·∫£i ƒë·ªïi d·∫•u mouseMovementX. V·ªõi nh√¨n l√™n xu·ªëng, th√¨
                    ta xoay theo tr·ª•c right, c≈©ng ƒë·ªïi d·∫•u mouseMovementY v·ªõi l√≠ do t∆∞∆°ng t·ª±. H√†m updateMovement nh·∫≠n v√†o dt c·ªßa frame hi·ªán t·∫°i, v√† keyStates, l√† m·ªôt m·∫£ng ƒë√°nh d·∫•u ph√≠m n√†o
                    ƒëang ƒë∆∞·ª£c nh·∫•n trong frame hi·ªán t·∫°i, d·ª±a v√†o keystates ƒë·ªÉ c·ªông tr·ª´ pos t∆∞∆°ng ·ª©ng.
                    <pre><code class="language-javascript">class Camera {
    constructor(pos, euler, speed, sensitivity) {
        this.pos = pos;
        this.rotation = Quaternion.buildQuaternionEuler(euler);
        this.speed = speed;
        this.sensitivity = sensitivity;
    }

    updateRotation(mouseMovementX, mouseMovementY) {
        let q = Quaternion.buildQuaternionAxisAngle(Vector3.up, -mouseMovementX * this.sensitivity);

        let right = this.rotation.rotateVector(Vector3.right);
        q = Quaternion.multiply(q, Quaternion.buildQuaternionAxisAngle(right, -mouseMovementY * this.sensitivity));

        this.rotation = Quaternion.multiply(q, this.rotation);
    }

    updateMovement(dt, keyStates) {
        let forward = this.rotation.rotateVector(Vector3.forward);
        let right = this.rotation.rotateVector(Vector3.right);

        if (keyStates['w']) {
            this.pos = Vector3.add(this.pos, Vector3.mul(forward, dt * this.speed));
        }
        if (keyStates['s']) {
            this.pos = Vector3.sub(this.pos, Vector3.mul(forward, dt * this.speed));
        }
        if (keyStates['a']) {
            this.pos = Vector3.sub(this.pos, Vector3.mul(right, dt * this.speed));
        }
        if (keyStates['d']) {
            this.pos = Vector3.add(this.pos, Vector3.mul(right, dt * this.speed));
        }
        if (keyStates['Shift']) {
            this.pos = Vector3.add(this.pos, Vector3.mul(Vector3.down, dt * this.speed));
        }
        if (keyStates[' ']) {
            this.pos = Vector3.add(this.pos, Vector3.mul(Vector3.up, dt * this.speed));
        }
    }

    getViewMatrix() {
        let forward = this.rotation.rotateVector(Vector3.forward);
        let right = this.rotation.rotateVector(Vector3.right);
        let up = this.rotation.rotateVector(Vector3.up);
        return Mat4x4.View(right, up, forward, this.pos);
    }
}</code></pre>
                    ·ªû b√™n ngo√†i, ta t·∫°o m·ªôt object camera v·ªõi speed l√† 2 v√† sensitivity l√† 0.2 (b·∫°n c√≥ th·ªÉ th·ª≠ v√† ƒëi·ªÅu ch·ªânh theo s·ªë b·∫°n mu·ªën):
                    <pre><code class="language-javascript">let camera = new Camera(Vector3.zero, Vector3.zero, 2, 0.2);</code></pre>
                    Trong h√†m update, ·ªü m·ªói frame ta t√≠nh l·∫°i view matrix, sau ƒë√≥ nh√¢n view matrix ƒë√≥ v·ªõi t·ª´ng ƒë·ªânh tr∆∞·ªõc khi nh√¢n projection matrix, nh·ªõ b·ªè
                    bi·∫øn cameraPos m√† ta x√†i ƒë·ªÉ th·ª±c hi·ªán face culling v√† thay b·∫±ng camera.pos:
                    <pre><code class="language-javascript">function update(time = performance.now()) {
    ...
    const viewMat = camera.getViewMatrix();
    ...

    for (let tri of allTris) {
        if (Vector3.dot(tri.getNormal(), Vector3.sub(tri.getCenter(), camera.pos)) < 0) {
            let vertices = tri.vertices;
            for (let i = 0; i < vertices.length; i++) {
                vertices[i].mulMat4x4(viewMat);
                vertices[i].mulMat4x4(projectionMatrix);
                ...
            }
            ...
        }
    }
}</code></pre>

                    ƒê·ªëi v·ªõi di chuy·ªÉn camera th√¨ ta khai b√°o keyStates, ƒëƒÉng k√Ω 2 event 
                    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/keydown_event">keydown</a> v√† 
                    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/keyup_event">keyup</a> ƒë·ªÉ nh·∫≠n event nh·∫•n ph√≠m xu·ªëng v√† th·∫£ ph√≠m ra,
                    l·∫•y ph√≠m ƒëang nh·∫•n b·∫±ng e.key v√† set th√†nh true ho·∫∑c false t∆∞∆°ng ·ª©ng.
                    <pre><code class="language-javascript">let keyStates = [];

...
                        
window.addEventListener('keydown', (e) => {
    keyStates[e.key] = true;
});
window.addEventListener('keyup', (e) => {
    keyStates[e.key] = false;
});</code></pre>
                    ·ªû h√†m update th√¨ g·ªçi h√†m updateMovement ·ªü frame hi·ªán t·∫°i (tr∆∞·ªõc khi t√≠nh view matrix):
                    <pre><code class="language-javascript">function update(time = performance.now()) {
                        
    ...

    camera.updateMovement(dt, keyStates);
    const viewMat = camera.getViewMatrix();

    ...

}</code></pre>
                    ƒê·ªëi v·ªõi xoay camera, tr∆∞·ªõc ti√™n ta ph·∫£i lock chu·ªôt l·∫°i ·ªü v·ªã tr√≠ ch√≠nh gi·ªØa m√†n h√¨nh ƒë·ªÉ cho c·∫£m gi√°c y h·ªát game FPS, ta check khi user
                    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/click_event">click</a> v√†o canvas th√¨ g·ªçi h√†m 
                    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/requestPointerLock">requestPointerLock</a> ƒë·ªÉ lock chu·ªôt v√† set
                    unadjustedMovement th√†nh true ƒë·ªÉ b·ªè mouse acceleration. Ta ƒëƒÉng k√Ω th√™m event <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/mousemove_event">mousemove</a>,
                    n·∫øu chu·ªôt ƒëang ƒë∆∞·ª£c lock trong canvas th√¨ l·∫•y movementX v√† movementY t·ª´ e l√†m tham s·ªë ƒë·ªÉ g·ªçi updateRotation. 
                    Khi ta di chuy·ªÉn chu·ªôt th√¨ movementX v√† movementY s·∫Ω thay ƒë·ªïi t√πy v√†o t·ªëc ƒë·ªô ta di chu·ªôt (n·∫øu
                    b·∫°n mu·ªën xem c·ª• th·ªÉ th√¨ c√≥ th·ªÉ console.log n√≥ ra), c√≤n khi chu·ªôt ƒë·ª©ng y√™n th√¨ n√≥ c≈©ng ƒë·ª©ng y√™n. L∆∞u √Ω l√† ta kh√¥ng s·ª≠ d·ª•ng x·ª≠ l√Ω deltaTime v√¨ s·ª± ki·ªán mouseMove ƒë∆∞·ª£c
                    g·ªçi d·ª±a v√†o con chu·ªôt ƒë∆∞·ª£c di chuy·ªÉn bao nhi√™u, n√≥ s·∫Ω kh√° gi·ªëng nhau tr√™n m·ªçi thi·∫øt b·ªã, c≈©ng t√πy v√†o ph·∫ßn c·ª©ng v√† setting c·ªßa chu·ªôt.

                    <pre><code class="language-javascript">canvas.addEventListener("click", async () => {
    await canvas.requestPointerLock({
        unadjustedMovement: true,
    });
});

canvas.addEventListener("mousemove", (e) => {
    if (document.pointerLockElement === canvas) {
        camera.updateRotation(e.movementX, e.movementY);
    }
});</code></pre>
                    Full code (nh·∫•n v√†o canvas ƒë·ªÉ th·ª≠):
                    <div class="htmlPreview" id="htmlPreview14"></div>
                    Khi b·∫°n di chuy·ªÉn qua l·∫°i b·∫°n s·∫Ω th·∫•y ngay 2 v·∫•n ƒë·ªÅ l·ªõn:
                    <ol>
                        <li>Di chuy·ªÉn sao cho 2 cube align v·ªõi nhau s·∫Ω th·∫•y ƒë∆∞·ª£c cube ƒë·∫±ng sau m·∫∑c d√π b·ªã cube ƒë·∫±ng tr∆∞·ªõc che</li>
                        <li>Khi b·∫°n ƒëi xuy√™n qua cube v√† ƒëi th√™m m·ªôt ƒëo·∫°n n·ªØa, b·∫°n l·∫°i th·∫•y ƒë∆∞·ª£c 2 cube nh∆∞ng l√∫c n√†y b·∫°n c√†ng ƒëi n√≥ c√†ng xa (th·∫≠t ra b·∫°n ƒëang th·∫•y ƒë∆∞·ª£c ƒë·∫±ng sau b·∫°n)</li>
                    </ol>
                    ƒê·ª´ng lo, 2 c√°i n√†y kh√¥ng li√™n quan t·ªõi View matrix, ta ƒë√£ xong v·ªõi view matrix r·ªìi üò≥
                    <div id="graphics3D-nav-bottom"></div>
                </div>

            </div>
        </div>
    </main>

    <footer></footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script src="graphics3D.js"></script>
    <script src="/js/loadsidebar.js"></script>
</body>

</html>