<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/blogcontent.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="graphics3D.css">

    <script src="/js/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <title>Graphics Engine 3D</title>
</head>

<body data-graphics3D-id="graphics3D8">
    <main>
        <div class="container-fluid ps-0">
            <div class="row">
                <div class="col-12 col-lg-2 sidebar pb-0 pe-0">
                    <!--load from sidebar.html-->
                </div>

                <div class="blog-content col-12 col-lg-10">
                    <div id="graphics3D-nav-top"></div>
                    <h1>View matrix</h1>
                    
                    Ta s·∫Ω v·ªÅ l·∫°i v·ªõi ma tr·∫≠n sau m·ªôt blog kh·ªßng ho·∫£ng v·ªõi to√°n 4D ü•µ Blog n√†y kh√¥ng n·∫±m k·∫ø ti·∫øp blog model (ƒë·ªß b·ªô Model View Project matrix) l√† c√≥ l√≠ do c·∫£.<br/><br/>

                    T·ª´ ƒë·∫ßu t·ªõi gi·ªù ta ch·ªâ "ƒë√∫ng m·ªôt ch·ªó nh√¨n", render ƒë√∫ng 1 g√≥c nh√¨n ·ªü 1 v·ªã tr√≠ c·ªë ƒë·ªãnh (0, 0, 0), n·∫øu nh∆∞ ta mu·ªën "xoay ch·ªó kh√°c" hay "ƒëi ch·ªó kh√°c" th√¨ sao? ƒê√≥ ch√≠nh
                    l√† c√¥ng d·ª•ng c·ªßa View matrix, l√† ƒëi·ªÅu khi·ªÉn "camera" v√† hi·ªÉn th·ªã ƒë√∫ng nh·ªØng g√¨ m√† "camera" th·∫•y.<br/><br/>

                    ƒê·∫ßu ti√™n, ta ph·∫£i hi·ªÉu l√† View matrix kh√¥ng di chuy·ªÉn hay xoay camera, m√† th·∫≠t ra l√† ƒëang di chuy·ªÉn v√† xoay c·∫£ th·∫ø gi·ªõi quanh camera, camera v·∫´n lu√¥n ·ªü
                    (0, 0, 0) v√† lu√¥n nh√¨n theo tr·ª•c Z (n·∫øu l√† h·ªá t·ªça ƒë·ªô tay tr√°i). V√≠ d·ª• ta mu·ªën camera ·ªü v·ªã tr√≠ (0, 2, -5) v√† euler angles c·ªßa n√≥ l√† (30, -50, 40), ta ph·∫£i
                    di chuy·ªÉn to√†n b·ªô object (0, -2, 5) v√† xoay to√†n b·ªô object quanh g·ªëc t·ªça ƒë·ªô (ch·ª© ko ph·∫£i quanh t√¢m c·ªßa ch√≠nh n√≥) (-30, 50, -40) (xoay theo th·ª© t·ª± \(z \rightarrow
                    y \rightarrow x\), ng∆∞·ª£c v·ªõi l√∫c xoay object).<br/><br/>
                    
                    Theo v√≠ d·ª• ƒë√≥, view matrix ch·ªâ l√† k·∫øt qu·∫£ nh√¢n c·ªßa 3 rotation matrix v√† 1 translation matrix, g·ªçi v·ªã tr√≠ camera
                    l√† \(t\) v√† euler angles c·ªßa camera l√† \((\alpha, \beta, \gamma)\), view matrix s·∫Ω c√≥ d·∫°ng nh∆∞ sau:
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos{(-\alpha)} & sin{(-\alpha)} & 0\\
                        0 & -\sin{(-\alpha)} & \cos{(-\alpha)} & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}

                        \begin{pmatrix}
                        cos{(-\beta)} & 0 & -sin{(-\beta)} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{(-\beta)} & 0 & \cos{(-\beta)} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        
                        \begin{pmatrix}
                        cos{(-\gamma)} & sin{(-\gamma)} & 0 & 0\\
                        -\sin{(-\gamma)} & \cos{(-\gamma)} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}

                        \begin{pmatrix}
                        1 & 0 & 0 & -t_{x}\\
                        0 & 1 & 0 & -t_{y}\\
                        0 & 0 & 1 & -t_{z}\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$
                    $$
                        =
                        \begin{pmatrix}
                        \cos\beta\cos\gamma &
                        -\cos\beta\sin\gamma &
                        \sin\beta &
                        -(\cos\beta\cos\gamma\,t_x
                        -\cos\beta\sin\gamma\,t_y
                        +\sin\beta\,t_z)
                        \\
                        \sin\alpha\sin\beta\cos\gamma + \cos\alpha\sin\gamma &
                        -\sin\alpha\sin\beta\sin\gamma + \cos\alpha\cos\gamma &
                        -\sin\alpha\cos\beta &
                        -( (\sin\alpha\sin\beta\cos\gamma + \cos\alpha\sin\gamma)t_x
                        +(-\sin\alpha\sin\beta\sin\gamma + \cos\alpha\cos\gamma)t_y
                        -\sin\alpha\cos\beta\,t_z )
                        \\
                        -\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma &
                        \cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma &
                        \cos\alpha\cos\beta &
                        -( (-\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma)t_x
                        +(\cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma)t_y
                        +\cos\alpha\cos\beta\,t_z )
                        \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$
                    <div align="center" style="font-size: 14px"><i>M√¨nh d√πng ChatGPT ƒë·ªÉ ra ƒë∆∞·ª£c k·∫øt qu·∫£ tr√™n v√¨ nh√¢n b·∫±ng tay ch·∫Øc t·ªõi mai ü•µ</i></div><br/>
                    N·∫øu b·∫°n th·∫•y r·ªëi v√¨ ·ªü tr√™n m√¨nh n√≥i l√† theo th·ª© t·ª± \(z \rightarrow y \rightarrow x\) nh∆∞ng l√∫c nh√¢n l·∫°i l√† ng∆∞·ª£c l·∫°i, ƒë√≥ l√† v√¨ ta ƒëang applied ma tr·∫≠n t·ª´ ph·∫£i sang
                    tr√°i, xem l·∫°i code c·ªßa <a href="graphics3D5-model.html">blog 5</a>, ma tr·∫≠n n·∫±m b√™n tr√°i vector, v√† ma tr·∫≠n n√†o ƒë∆∞·ª£c l√†m tr∆∞·ªõc s·∫Ω n·∫±m b√™n ph·∫£i.<br/><br/>
                    N·∫øu b·∫°n mu·ªën, b·∫°n c√≥ th·ªÉ x√†i lu√¥n ma tr·∫≠n b√πi nh√πi ƒë√≥ v√†o trong engine üòÇ, v√† n√≥ s·∫Ω ch·∫°y ƒë√∫ng. Nh∆∞ng trong ƒë·ªì h·ªça 3D th√¨ kh√¥ng ai bi·ªÉu di·ªÖn view matrix v·ªõi euler angles c·∫£, m√†
                    thay v√†o ƒë√≥ ng∆∞·ªùi ta s·∫Ω d√πng 3 vector ƒë∆°n v·ªã ƒë·∫°i di·ªán cho tr·ª•c local c·ªßa camera, g·ªçi l√† forward (\(\vec{f}\)), up (\(\vec{u}\)) v√† right (\(\vec{r}\)).
                    Th·∫≠t ra b·∫°n c√≥ th·ªÉ chuy·ªÉn ma tr·∫≠n tr√™n th√†nh ma tr·∫≠n ch·ªâ c√≥ forward, up, right n·∫øu b·∫°n ƒë·ªß ki√™n nh·∫´n ƒë·ªÉ l√†m l∆∞·ª£ng gi√°c v·ªõi kh√¥ng gian 3D.<br/><br/>
                    C√°ch t·ªët nh·∫•t l√† t·ª´ forward, up, right l√†m l√™n, ta s·∫Ω xoay 3 vector ƒë√≥ l·∫ßn l∆∞·ª£t theo t·ª´ng tr·ª•c xem n√≥ th√†nh g√¨, b√¢y gi·ªù th√¨ ta l·∫°i xoay n√≥ nh∆∞ xoay object (\(x \rightarrow y \rightarrow z\)),
                    v√¨ ta c≈©ng c√≥ th·ªÉ xem camera nh∆∞ m·ªôt object.<br/><br/>
                    ƒê·∫ßu ti√™n ta c√≥:
                    $$
                    \begin{eqnarray}
                    r = (1, 0, 0)\\
                    u = (0, 1, 0)\\
                    f = (0, 0, 1)
                    \end{eqnarray}
                    $$
                    Xoay theo tr·ª•c \(x\), l√† nh√¢n cho x rotation matrix:
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos\alpha & sin\alpha & 0\\
                        0 & -\sin\alpha & \cos\alpha & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        1\\
                        0\\
                        0\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        1\\
                        0\\
                        0\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos\alpha & sin\alpha & 0\\
                        0 & -\sin\alpha & \cos\alpha & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        1\\
                        0\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        0\\
                        \cos{\alpha}\\
                        -\sin{\alpha}\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & 0\\
                        0 & cos\alpha & \sin\alpha & 0\\
                        0 & -\sin\alpha & \cos\alpha & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        0\\
                        1\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        0\\
                        \sin\alpha\\
                        \cos\alpha\\
                        0
                        \end{pmatrix}
                    $$
                    Xoay theo tr·ª•c \(y\):
                    $$
                        \begin{pmatrix}
                        cos{\beta} & 0 & -\sin{\beta} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{\beta} & 0 & \cos{\beta} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        1\\
                        0\\
                        0\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \cos{\beta}\\
                        0\\
                        \sin{\beta}\\
                        0\\
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\beta} & 0 & -\sin{\beta} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{\beta} & 0 & \cos{\beta} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        \cos{\alpha}\\
                        -\sin{\alpha}\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \sin\alpha\sin\beta\\
                        \cos\alpha\\
                        -sin\alpha\cos\beta\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\beta} & 0 & -\sin{\beta} & 0\\
                        0 & 1 & 0 & 0\\
                        \sin{\beta} & 0 & \cos{\beta} & 0 \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        0\\
                        \sin\alpha\\
                        \cos\alpha\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        -\cos\alpha\sin\beta\\
                        \sin\alpha\\
                        \cos\alpha\cos\beta\\
                        0
                        \end{pmatrix}
                    $$
                    Xoay theo tr·ª•c \(z\):
                    $$
                        \begin{pmatrix}
                        cos{\gamma} & \sin{\gamma} & 0 & 0\\
                        -\sin{\gamma} & \cos{\gamma} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        \cos{\beta}\\
                        0\\
                        \sin{\beta}\\
                        0\\
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \cos{\beta}\cos{\gamma}\\
                        -\cos{\beta}\sin{\gamma}\\
                        \sin{\beta}\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\gamma} & \sin{\gamma} & 0 & 0\\
                        -\sin{\gamma} & \cos{\gamma} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        \sin{\beta}\sin{\alpha}\\
                        \cos{\alpha}\\
                        -\sin{\alpha}\cos{\beta}\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        \sin{\alpha}\sin{\beta}\cos{\gamma} + \cos{\alpha}\sin{\gamma}\\
                        -\sin{\alpha}\sin{\beta}\sin{\gamma} + \cos{\alpha}\cos{\gamma}\\
                        -\sin{\alpha}\cos{\beta}\\
                        0
                        \end{pmatrix}
                    $$
                    $$
                        \begin{pmatrix}
                        cos{\gamma} & \sin{\gamma} & 0 & 0\\
                        -\sin{\gamma} & \cos{\gamma} & 0 & 0\\
                        0 & 0 & 1 & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                        \begin{pmatrix}
                        -\cos\alpha\sin{\beta}\\
                        \sin\alpha\\
                        \cos\alpha\cos\beta\\
                        0
                        \end{pmatrix}=
                        \begin{pmatrix}
                        -\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma\\
                        \cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma\\
                        \cos\alpha\cos\beta\\
                        0
                        \end{pmatrix}
                    $$
                    Nh∆∞ v·∫≠y:
                    $$
                    r' = \begin{pmatrix}
                        \cos{\beta}\cos{\gamma}\\
                        -\cos{\beta}\sin{\gamma}\\
                        \sin{\beta}
                        \end{pmatrix}
                    $$
                    $$
                    u' = \begin{pmatrix}
                        \sin{\alpha}\sin{\beta}\cos{\gamma} + \cos{\alpha}\sin{\gamma}\\
                        -\sin{\alpha}\sin{\beta}\sin{\gamma} + \cos{\alpha}\cos{\gamma}\\
                        -\sin{\alpha}\cos{\beta}
                        \end{pmatrix}
                    $$
                    $$
                    f' = \begin{pmatrix}
                        -\cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma\\
                        \cos\alpha\sin\beta\sin\gamma + \sin\alpha\cos\gamma\\
                        \cos\alpha\cos\beta
                        \end{pmatrix}
                    $$
                    G√°n v√†o ma tr·∫≠n b√πi nh√πi ·ªü tr√™n, th·∫ø l√† ta c√≥ view matrix m√† ta mu·ªën:
                    $$
                        \begin{pmatrix}
                        r'_x & r'_y & r'_z & -r'_x.t_x -r'_y.t_x-r'_z.t_z\\
                        u'_x & u'_y & u'_z & -u'_x.t_x -u'_y.t_x-u'_z.t_z \\
                        f'_x & f'_y & f'_z & -f'_x.t_x -f'_y.t_x-f'_z.t_z \\
                        0 & 0 & 0 & 1
                        \end{pmatrix}=
                        \begin{pmatrix}
                        r'_x & r'_y & r'_z & -\langle r, t \rangle\\
                        u'_x & u'_y & u'_z & -\langle u, t \rangle\\
                        f'_x & f'_y & f'_z & -\langle f, t \rangle\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$
                    N·∫øu b·∫°n t√¨m google v·ªÅ View matrix, th∆∞·ªùng th√¨ ng∆∞·ªùi ta s·∫Ω nh·∫Øc t·ªõi LookAt matrix (ƒë∆°n gi·∫£n ch·ªâ l√† ma tr·∫≠n k·∫øt h·ª£p xoay v√† di chuy·ªÉn, ma tr·∫≠n n√†y c≈©ng theo
                    forward, up, right). Ngh·ªãch ƒë·∫£o ma tr·∫≠n LookAt s·∫Ω ra View matrix, th·∫≠t ra v·ªÅ b·∫£n ch·∫•t c≈©ng kh√¥ng kh√°c nh·ªØng g√¨ m√¨nh l√†m, ngh·ªãch ƒë·∫£o c·ªßa rotation matrix s·∫Ω ra
                    l·∫°i rotation matrix ƒë√≥ nh∆∞ng ƒë·ªëi d·∫•u g√≥c, ngh·ªãch ƒë·∫£o translation matrix c≈©ng ra l·∫°i ma tr·∫≠n ƒë√≥ nh∆∞ng ƒë·ªïi d·∫•u \(t\). N·∫øu b·∫°n hi·ªÉu b·∫£n ch·∫•t c·ªßa ngh·ªãch ƒë·∫£o ma tr·∫≠n
                    th√¨ hi·ªÉu theo c√°ch ƒë√≥ c≈©ng ƒë∆∞·ª£c üò≥ Ngo√†i ra khi t√¨m google b·∫°n s·∫Ω th·∫•y nhi·ªÅu phi√™n
                    b·∫£n kh√°c nhau c·ªßa View Matrix, ƒë√≥ l√† v√¨ n√≥ kh√°c nhau v·ªÅ handedness c·ªßa h·ªá t·ªça ƒë·ªô (tr√°i hay ph·∫£i) v√† vector ·ªü d·∫°ng ma tr·∫≠n l√† column hay row, v·ªõi engine m√¨nh ƒëang
                    l√†m th√¨ n√≥ l√† h·ªá t·ªça ƒë·ªô tay tr√°i (left-handed coordinate) v√† vector l√† column vector n·∫øu b·∫°n kh√¥ng nh·ªõ.<br/>
                    Nh√¨n v√†o view matrix, b·∫°n c≈©ng ph·∫ßn n√†o ƒëo√°n ƒë∆∞·ª£c n√≥ l√†m g√¨, kh·ªëi 3x3 ·ªü g√≥c tr√°i khi nh√¢n v·ªõi \(v\) n√≥ s·∫Ω ra t√≠ch c√≥ h∆∞·ªõng c·ªßa \(v\) v·ªõi \(r, u, f\), ƒë·ªìng nghƒ©a
                    "h√¨nh chi·∫øu c·ªßa \(v\) tr√™n 3 tr·ª•c m·ªõi \(r, u, f\)". V√† 3 c√°i t√≠ch v√¥ h∆∞·ªõng v·ªõi \(t\) l√† "c·ªông v√†o \(v\) m·ªôt vector \(t'\) ƒë√£ ƒë∆∞·ª£c bi·∫øn ƒë·ªïi theo tr·ª•c m·ªõi".<br/><br/>

                    C√≥ ƒë∆∞·ª£c View matrix r·ªìi, ta b·∫Øt tay v√†o code th√¥i, ta s·∫Ω l√†m lu√¥n m·ªôt h·ªá th·ªëng di chuy·ªÉn camera nh∆∞ FPS, d√πng chu·ªôt ƒë·ªÉ nh√¨n qua l·∫°i, WASD ƒë·ªÉ di chuy·ªÉn, ngo√†i ra Space
                    ƒë·ªÉ bay l√™n v√† Shift ƒë·ªÉ bay xu·ªëng.
                    
                    <div id="graphics3D-nav-bottom"></div>
                </div>

            </div>
        </div>
    </main>

    <footer></footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script src="graphics3D.js"></script>
    <script src="/js/loadsidebar.js"></script>
</body>

</html>