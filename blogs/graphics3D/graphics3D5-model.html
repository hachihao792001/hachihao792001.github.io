<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/blogcontent.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="graphics3D.css">

    <script src="/js/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <title>Graphics Engine 3D</title>
</head>

<body data-graphics3D-id="graphics3D5">
    <main>
        <div class="container-fluid ps-0">
            <div class="row">
                <div class="col-12 col-lg-2 sidebar pb-0 pe-0">
                    <!--load from sidebar.html-->
                </div>

                <div class="blog-content col-12 col-lg-10">
                    <div id="graphics3D-nav-top"></div>
                    <h1>Model matrix</h1>
                    Model matrix l√† m·ªôt trong 3 th√†nh ph·∫ßn t·∫°o n√™n Model View Projection matrix, model matrix t·∫≠p h·ª£p t·∫•t c·∫£ c√°c bi·∫øn ƒë·ªïi li√™n quan t·ªõi m·ªçi v·∫≠t th·ªÉ trong kh√¥ng
                    gian 3D, nh·ªØng bi·∫øn ƒë·ªïi n√†y l√† d·ªãch chuy·ªÉn, xoay v√† ph√≥ng to/nh·ªè. N·∫øu b·∫°n nh·ªõ, th√¨ h·ªìi l·ªõp 11 b·∫°n c√≥ h·ªçc v·ªÅ Ph√©p bi·∫øn h√¨nh, trong ƒë√≥ c√≥ ph√©p t·ªãnh ti·∫øn,
                    ph√©p xoay v√† ph√©p v·ªã t·ª±, ƒë√≥ ch√≠nh l√† 3 ph√©p bi·∫øn ƒë·ªïi m√† m√¨nh v·ª´a n√≥i üò≥.<br/><br/>

                    ƒê·∫ßu ti√™n l√† ph√©p d·ªãch chuy·ªÉn, ƒë∆∞·ª£c g·ªçi l√† Translation matrix, sau khi nh√¢n m·ªôt vector (ƒëi·ªÉm) \(v\) v·ªõi n√≥ th√¨ \(v\) s·∫Ω ƒë∆∞·ª£c di chuy·ªÉn theo m·ªôt h∆∞·ªõng n√†o ƒë√≥, g·ªçi
                    vector ƒë·∫°i di·ªán h∆∞·ªõng ƒë√≥ l√† \(t\), ta c·∫ßn t√¨m ma tr·∫≠n c√≥ th·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu sau:
                    $$
                        A*
                        \begin{pmatrix}
                        x \\
                        y \\
                        z \\
                        1
                        \end{pmatrix}
                        =
                        \begin{pmatrix}
                        x + t_{x}\\
                        y + t_{y}\\
                        z + t_{z}\\
                        1
                        \end{pmatrix}
                    $$
                    Ta ƒë·ªÉ √Ω l√† c·∫£ 3 chi·ªÅu c·ªßa \(t\) ƒë·ªÅu c√≥ d·∫°ng bi·∫øn nh√¢n g√¨ ƒë√≥ c·ªông g√¨ ƒë√≥, nh∆∞ v·∫≠y ·ªü m·ªói h√†ng c·ªßa ma tr·∫≠n ta ch·ªâ c·∫ßn ƒë·ªÉ s·ªë 1 ·ªü ch·ªó bi·∫øn c·∫ßn gi·ªØ, v√† ƒë·ªÉ chi·ªÅu
                    t∆∞∆°ng t·ª± c·ªßa \(t\) ·ªü c·ªôt th·ª© 4 (\(w\)) l√† s·∫Ω ra l·∫°i ƒë∆∞·ª£c \(t\). Nh∆∞ v·∫≠y ma tr·∫≠n c·ªßa ch√∫ng ta s·∫Ω c√≥ d·∫°ng:
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0 & t_{x}\\
                        0 & 1 & 0 & t_{y}\\
                        0 & 0 & 1 & t_{z}\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$

                    Ti·∫øp theo ta s·∫Ω n√≥i v·ªÅ ph√©p ph√≥ng to/nh·ªè, g·ªçi vector ƒë·∫°i di·ªán cho gi√° tr·ªã ta mu·ªën scale ·ªü 3 chi·ªÅu l√† \(s\), ta c·∫ßn m·ªôt ma tr·∫≠n c√≥ th·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu sau:
                    $$
                        A *
                        \begin{pmatrix}
                        x \\
                        y \\
                        z \\
                        1
                        \end{pmatrix}
                        =
                        \begin{pmatrix}
                        x * s_{x}\\
                        y * s_{y}\\
                        z * s_{z}\\
                        1
                        \end{pmatrix}
                    $$
                    Nh∆∞ v·∫≠y th√¨ c√†ng d·ªÖ, m·ªói h√†ng c·ªßa ma tr·∫≠n ta ch·ªâ c·∫ßn ƒë·ªÉ chi·ªÅu t∆∞∆°ng ·ª©ng c·ªßa \(s\) v√†o chi·ªÅu c·ªßa \(v\) l√† ra:
                    $$
                        \begin{pmatrix}
                        s_{x} & 0 & 0 & 0\\
                        0 & s_{y} & 0 & 0\\
                        0 & 0 & s_{z} & 0\\
                        0 & 0 & 0 & 1
                        \end{pmatrix}
                    $$

                    Cu·ªëi c√πng ƒë·∫øn v·ªõi ph√©p xoay, l√† Rotation Matrix, c√°i n√†y s·∫Ω h∆°i kh√≥ t√≠. Cho n√™n ta h√£y n√≥i v·ªÅ n√≥ ·ªü 2D tr∆∞·ªõc, ta mu·ªën xoay m·ªôt vector \(v\) m·ªôt g√≥c
                    (\(Œ∏\)) xung quanh g·ªëc t·ªça ƒë·ªô (0; 0) th√†nh vector \(v'\) (l∆∞u √Ω l√† xoay ng∆∞·ª£c chi·ªÅu kim ƒë·ªìng h·ªì). ƒê·ªÉ cho ƒë√∫ng ƒê·∫°i s·ªë tuy·∫øn t√≠nh (v√† c≈©ng ƒë·ªÉ d·ªÖ t√≠nh),
                    ta s·∫Ω v·∫Ω lu√¥n tr·ª•c x, y sau khi xoay xong, c√°i n√†y ng∆∞·ªùi ta g·ªçi l√† chuy·ªÉn h·ªá quy chi·∫øu, hay chuy·ªÉn c∆° s·ªü sao ƒë√≥ m√¨nh c≈©ng qu√™n r·ªìi. 
                    M√¨nh t√¥ m√†u h·ªá quy chi·∫øu c·ªßa \(v\) l√† m√†u ƒëen v√† h·ªá quy chi·∫øu c·ªßa \(v'\) l√† ƒë·ªè ƒë·ªÉ cho b·∫°n d·ªÖ nh√¨n.
                    <div align="center">
                        <img style="max-width: 500px;" src="images/graphics3D5/rotation.png"/>
                    </div>

                    M·ª•c ti√™u c·ªßa ta l√† t√¨m ƒë∆∞·ª£c t·ªça ƒë·ªô c·ªßa \(v'\) tr√™n h·ªá quy chi·∫øu ƒëen d·ª±a v√†o t·ªça ƒë·ªô c·ªßa \(v\) v√† (\(Œ∏\)). B·∫°n c√≥ th·ªÉ t·ª± l√†m th·ª≠, ƒë·ªëi v·ªõi m√¨nh
                    th√¨ m√¨nh v·∫Ω c√°c ƒë∆∞·ªùng v√† c√°c k√Ω hi·ªáu sau:
                    <div align="center">
                        <img style="max-width: 600px;" src="images/graphics3D5/rotation2.png"/>
                    </div>

                    L·∫•y \(\vec{v_{x}}\) tr√™n h·ªá quy chi·∫øu ƒë·ªè chi·∫øu l√™n tr·ª•c \(x\) c·ªßa h·ªá quy chi·∫øu ƒëen, g·ªçi ƒë·ªô d√†i h√¨nh chi·∫øu ƒë√≥ l√† \(A\),
                    l·∫•y \(\vec{v_{y}}\) tr√™n h·ªá quy chi·∫øu ƒë·ªè chi·∫øu l√™n tr·ª•c \(x\) c·ªßa h·ªá quy chi·∫øu ƒëen, g·ªçi ƒë·ªô d√†i h√¨nh chi·∫øu ƒë√≥ l√† \(B\).
                    Ta th·∫•y \(|\vec{v'_{x}}| = A - B\), v√† \(A = |v_x|\cos{Œ∏}, B=|v_y|\sin{Œ∏}\), suy ra
                    \(v'_{x} = v_x\cos{Œ∏} - v_y\sin{Œ∏}\). (\(|\vec{v'_{x}}|\) l√† ƒë·ªô d√†i h√¨nh chi·∫øu c·ªßa \(v'\) l√™n tr·ª•c \(x\), \(v'_x\) l√† gi√° tr·ªã \(x\) c·ªßa \(v'\), c∆° b·∫£n l√† gi·ªëng nhau)<br/>
                    L·∫•y \(\vec{v_{x}}\) tr√™n h·ªá quy chi·∫øu ƒë·ªè chi·∫øu l√™n tr·ª•c \(y\) c·ªßa h·ªá quy chi·∫øu ƒëen, g·ªçi ƒë·ªô d√†i h√¨nh chi·∫øu ƒë√≥ l√† \(C\),
                    l·∫•y \(\vec{v_{y}}\) tr√™n h·ªá quy chi·∫øu ƒë·ªè chi·∫øu l√™n tr·ª•c \(y\) c·ªßa h·ªá quy chi·∫øu ƒëen, g·ªçi ƒë·ªô d√†i h√¨nh chi·∫øu ƒë√≥ l√† \(D\).
                    Ta th·∫•y \(|\vec{v'_{y}}| = C + D\), v√† \(C = |v_x|\sin{Œ∏}, D=|v_y|\cos{Œ∏}\), suy ra
                    \(v'_{y} = v_x\sin{Œ∏} + v_y\cos{Œ∏}\).<br/><br/>

                    M√¨nh khuy·∫øn kh√≠ch b·∫°n n√™n l√†m th·ª≠ l·∫°i t·ª´ h√¨nh ban ƒë·∫ßu ƒë·ªÉ th·∫≠t s·ª± hi·ªÉu v√† nh·ªõ, h√¨nh tr√™n v·∫Ω h·∫øt c√°c ƒë∆∞·ªùng n√©t ƒë·ª©t v√† ƒë√°nh d·∫•u c√°c g√≥c b·∫±ng nhau n√™n b·∫°n nh√¨n ra r·∫•t d·ªÖ.
                    B√¢y gi·ªù m√¨nh s·∫Ω chuy·ªÉn n√≥ th√†nh ma tr·∫≠n, m√¨nh c·∫ßn m·ªôt ma tr·∫≠n \(A\) l√†m ƒë∆∞·ª£c ƒëi·ªÅu nh∆∞ sau:
                    $$
                        A *
                        \begin{pmatrix}
                        v_x \\
                        v_y \\
                        \end{pmatrix}
                        =
                        \begin{pmatrix}
                        v_x\cos{Œ∏} - v_y\sin{Œ∏} \\
                        v_x\sin{Œ∏} + v_y\cos{Œ∏} \\
                        \end{pmatrix}
                    $$
                    N√≥ ƒë√∫ng lu√¥n d·∫°ng nh√¢n t·ª´ng √¥ tr√™n 1 h√†ng v√† c·ªông l·∫°i v·ªõi nhau, n√™n ta suy ra ƒë∆∞·ª£c lu√¥n ma tr·∫≠n:
                    $$
                        \begin{pmatrix}
                        cos{Œ∏} & -sin{Œ∏} \\
                        \sin{Œ∏} & \cos{Œ∏} \\
                        \end{pmatrix}
                    $$
                    Th·∫≠t ra ta kh√¥ng c·∫ßn ph·∫£i ch·ª©ng minh kh·ªï nh∆∞ th·∫ø ƒë√¢u, n·∫øu b·∫°n hi·ªÉu b·∫£n ch·∫•t c·ªßa h√†m \(cos\) v√† \(sin\) l√† ƒë·ªô d√†i h√¨nh chi·∫øu c·ªßa 1 vector ƒë∆°n v·ªã l√™n tr·ª•c \(x\) v√† \(y\),
                    th√¨ b·∫°n s·∫Ω suy ra ƒë∆∞·ª£c ngay khi xoay vector ƒë∆°n v·ªã c√πng chi·ªÅu v·ªõi tr·ª•c \(x\) 1 g√≥c \(\theta\), t·ªça ƒë·ªô m·ªõi c·ªßa n√≥ s·∫Ω l√† \((\cos{Œ∏}, \sin{Œ∏})\), 
                    v√† xoay vector ƒë∆°n v·ªã c√πng chi·ªÅu v·ªõi tr·ª•c y 1 g√≥c \(\theta\) th√¨ t·ªça ƒë·ªô m·ªõi c·ªßa n√≥ l√† \((\cos{(Œ∏+90)}, \sin{(Œ∏+90)}) = (-\sin{Œ∏}, \cos{Œ∏})\). M√¨nh ch·ª©ng m√¨nh b·∫±ng h√¨nh v·∫Ω
                    lo·∫±n ngo·∫±n ·ªü tr√™n l√† v√¨ mu·ªën over-explain m·ªçi th·ª© ƒë·ªÉ cho ng∆∞·ªùi ch·ªâ bi·∫øt "sin = ƒë·ªëi / huy·ªÅn, cos = k·ªÅ / huy·ªÅn" c≈©ng hi·ªÉu ƒë∆∞·ª£c.<br/><br/>
                    B√¢y gi·ªù ta s·∫Ω chuy·ªÉn n√≥ qua 3D, thay v√¨ l√†m h·∫øt t·∫•t c·∫£ 3 chi·ªÅu, ta s·∫Ω l√†m t·ª´ng chi·ªÅu m·ªôt. ƒê·∫ßu ti√™n l√† khi ta mu·ªën xoay 1 ƒëi·ªÉm quanh tr·ª•c \(y\), ta suy nghƒ© s·∫Ω 
                    th·∫•y l√† \(y\) c·ªßa ƒëi·ªÉm ƒë√≥ s·∫Ω gi·ªØ nguy√™n, v√† \(x\), \(z\) s·∫Ω thay ƒë·ªïi nh∆∞ c√°ch xoay 2 chi·ªÅu b√¨nh th∆∞·ªùng. Cho n√™n khi ta x√¢y ma tr·∫≠n, v·ªõi h√†ng 2 ta s·∫Ω ƒë·ªÉ s·ªë 1 
                    ·ªü c·ªôt 2 ƒë·ªÉ gi·ªØ l·∫°i x, h√†ng 1 v√† 3 ta s·∫Ω ƒë·ªÉ c·ªôt 2 l√† 0 v√† c·ªôt 1, 3 s·∫Ω nh∆∞ ma tr·∫≠n cho 2D ·ªü tr√™n.
                    $$
                        \begin{pmatrix}
                        cos{Œ∏} & 0 & -sin{Œ∏}\\
                        0 & 1 & 0 \\
                        \sin{Œ∏} & 0 & \cos{Œ∏} \\
                        \end{pmatrix}
                        
                    $$
                    ƒê·ªëi v·ªõi \(x\) v√† \(z\), v√¨ m√¨nh ch·ªçn h·ªá t·ªça ƒë·ªô tay tr√°i (left-handed coordinate) nh∆∞ ƒë√£ n√≥i ·ªü <a href="graphics3D2-definitions.html">blog 2</a>, ƒë·ªëi v·ªõi tr·ª•c
                    x, b·∫°n t∆∞·ªüng t∆∞·ª£ng nh√¨n th·∫≥ng v√†o tr·ª•c x (tr·ª•c x h∆∞·ªõng v√†o m·∫Øt m√¨nh), th√¨ b·∫°n s·∫Ω th·∫•y y h∆∞·ªõng l√™n v√† z h∆∞·ªõng qua ph·∫£i, nh∆∞ v·∫≠y l√† ng∆∞·ª£c v·ªõi c√°i ch·ª©ng minh 2D c·ªßa 
                    ch√∫ng ta (z c√≥ th·ª© t·ª± sau y, c≈©ng nh∆∞ y c√≥ th·ª© t·ª± sau x), l√∫c quay s·∫Ω b·ªã ng∆∞·ª£c, cho n√™n ta ƒë·ªïi d·∫•u \(\theta\), c≈©ng ƒë·ªìng nghƒ©a v·ªõi ƒë·ªïi d·∫•u \(\sin\theta\) v√†
                    gi·ªØ nguy√™n \(cos\theta\). T∆∞∆°ng t·ª± v·ªõi tr·ª•c z, nh√¨n th·∫≥ng v√†o tr·ª•c z ta th·∫•y y h∆∞·ªõng l√™n v√† x h∆∞·ªõng qua tr√°i, c≈©ng ng∆∞·ª£c, cho n√™n c≈©ng ph·∫£i ƒë·ªïi d·∫•u. Suy ra ma tr·∫≠n xoay c·ªßa x v√† z l√†:
                    $$
                        \begin{pmatrix}
                        1 & 0 & 0\\
                        0 & cos{Œ∏} & sin{Œ∏} \\
                        0 & -\sin{Œ∏} & \cos{Œ∏} \\
                        \end{pmatrix};

                        \begin{pmatrix}
                        cos{Œ∏} & sin{Œ∏} & 0\\
                        -\sin{Œ∏} & \cos{Œ∏} & 0 \\
                        0 & 0 & 1 \\
                        \end{pmatrix}
                    $$
                    Ta c√≥ th·ªÉ g·ªôp 3 ma tr·∫≠n n√†y v·ªõi nhau th√†nh m·ªôt ma tr·∫≠n duy nh·∫•t, tuy nhi√™n ta kh√¥ng n√™n l√†m v·∫≠y v√¨ s·∫Ω ra m·ªôt ma tr·∫≠n kh√° r·ªëi (\(Œ∏\) ·ªü 3 ma tr·∫≠n ƒë·ªÅu kh√°c nhau), v·ªõi
                    l·∫°i th·ª© t·ª± m√† ta nh√¢n 3 ma tr·∫≠n n√†y v·ªõi nhau c≈©ng quan tr·ªçng, \(XYZ \neq ZYX\) (n·∫øu b·∫°n kh√¥ng bi·∫øt, ph√©p nh√¢n ma tr·∫≠n kh√¥ng c√≥ t√≠nh ch·∫•t giao ho√°n).<br/>
                    Ngo√†i ra c√≥ m·ªôt th·ª© kh√°c m√† b·∫°n c·∫ßn bi·∫øt, tr∆∞·ªõc h·∫øt 3 ma tr·∫≠n n√†y ƒë·ªÅu quay theo tr·ª•c th·∫ø gi·ªõi (h·ªá quy chi·∫øu ƒëen), nh∆∞ng m√† n·∫øu b·∫°n mu·ªën xoay theo tr·ª•c c·ª•c b·ªô c·ªßa cube 
                    (h·ªá quy chi·∫øu ƒë·ªè) th√¨ sao? Nghƒ©a l√† sau khi b·∫°n quay xong theo tr·ª•c \(x\), b·∫°n s·∫Ω quay ti·∫øp theo tr·ª•c \(y\) m·ªõi c·ªßa cube ch·ª© kh√¥ng quay theo \(y\) th·∫ø gi·ªõi n·ªØa,
                    n√≥ g·ªçi l√† <b>intrinsic rotation</b>, c√≤n quay theo tr·ª•c th·∫ø gi·ªõi th√¨ ƒë∆∞·ª£c g·ªçi l√† <b>extrinsic rotation</b>.<br/>
                    ƒê·ªÉ quay ƒë∆∞·ª£c theo intrinsic rotation, b·∫°n n√™n bi·∫øt m·ªôt ƒë·ªãnh l√Ω l√†: Xoay \(x \rightarrow y \rightarrow z\) th·∫ø gi·ªõi s·∫Ω ra k·∫øt qu·∫£ gi·ªëng h·ªát xoay 
                    \(z \rightarrow y \rightarrow x\) c·ª•c b·ªô (v√† ng∆∞·ª£c l·∫°i c≈©ng ƒë√∫ng). 
                    V·ªÅ b·∫£n ch·∫•t to√°n h·ªçc m√¨nh s·∫Ω kh√¥ng n√≥i t·ªõi v√¨ m√¨nh kh√¥ng gi·ªèi to√°n ch·ª©ng minh c≈©ng nh∆∞ ƒê·∫°i s·ªë tuy·∫øn t√≠nh üòÖ. B·∫°n c√≥ th·ªÉ t∆∞·ªüng t∆∞·ª£ng l√† khi b·∫°n ng·∫©ng ƒë·∫ßu l√™n
                    15 ƒë·ªô v√† xoay ƒë·∫ßu qua ph·∫£i 45 ƒë·ªô, n√≥ s·∫Ω gi·ªëng nh∆∞ b·∫°n xoay ƒë·∫ßu qua ph·∫£i 45 ƒë·ªô v√† ng·∫©ng ƒë·∫ßu l√™n theo chi·ªÅu s·ªëng m≈©i c·ªßa b·∫°n 15 ƒë·ªô (ch·ª© kh√¥ng ph·∫£i theo chi·ªÅu song song v·ªõi
                    th√¢n b·∫°n), ho·∫∑c b·∫°n c√≥ th·ªÉ xem gif d∆∞·ªõi ƒë√¢y m√† m√¨nh l√†m trong Unity ƒë·ªÉ h√¨nh dung r√µ h∆°n:
                    <div align="center">
                        <img style="max-width: 400px;" src="images/graphics3D5/xyz.gif"/>
                    </div>
                    B·∫°n c·∫ßn l∆∞u √Ω l√† nh√¢n theo th·ª© t·ª± \(XYZ\) hay \(ZYX\) ƒë·ªÅu kh√¥ng quy·∫øt ƒë·ªãnh ƒë∆∞·ª£c ngay n√≥ l√† intrinsic hay extrinsic, c√≤n t√πy v√†o c√°ch m√¨nh s·ª≠ d·ª•ng n√≥ n·ªØa
                    (m√¨nh xin nh·∫Øc l·∫°i l√† c·∫£ 3 rotation matrix m√¨nh t√¨m ƒë∆∞·ª£c ·ªü tr√™n ƒë·ªÅu l√† extrinsic rotation <b>n·∫øu n√≥ ·ªü ri√™ng</b>),
                    nh∆∞ng m√† d√°m ch·∫Øc m·ªôt ƒëi·ªÅu l√† b·∫°n ph·∫£i th·ªëng nh·∫•t trong to√†n engine v·ªÅ th·ª© t·ª± nh√¢n, ƒë·ªëi v·ªõi m√¨nh th√¨ m√¨nh ch·ªçn \(XYZ\).<br/><br/>

                    To√°n ƒë√£ ƒë·ªß, b√¢y gi·ªù l√† code time üò≥ ƒê·∫ßu ti√™n ta t·∫°o nh·ªØng h√†m x√¢y d·ª±ng c√°c ma tr·∫≠n m√† ta ƒë√£ t√¨m ra, ƒë·ªÉ h·∫øt trong class Mat4x4. L∆∞u √Ω l√† ƒë·ªëi v·ªõi 3 c√°i rotation
                    matrix n√≥ v·∫´n l√† ma tr·∫≠n 4 chi·ªÅu, ƒë·ªÉ d√≤ng 4 c·ªôt 4 l√† 1 ƒë·ªÉ gi·ªØ nguy√™n \(w\) l√† ƒë∆∞·ª£c. Ngo√†i ra ta th√™m m·ªôt h√†m nh√¢n 2 ma tr·∫≠n, v√† ma tr·∫≠n ƒë∆°n v·ªã (l√† ma tr·∫≠n behave gi·ªëng
                    nh∆∞ s·ªë 1, ma tr·∫≠n n√†o nh√¢n n√≥ c≈©ng th√†nh ch√≠nh n√≥):
                    <pre><code class="language-javascript">class Mat4x4 {
    ...
    static Identity;

    static Multiply(m1, m2) {
        let result = new Mat4x4();
        for (let r = 0; r < 4; r++) {
            for (let c = 0; c < 4; c++) {
                result.m[r][c] =
                    m1.m[r][0] * m2.m[0][c] +
                    m1.m[r][1] * m2.m[1][c] +
                    m1.m[r][2] * m2.m[2][c] +
                    m1.m[r][3] * m2.m[3][c];
            }
        }
        return result;
    }

    ...

    static Translation(x, y, z) {
        let matrix = new Mat4x4();
        matrix.m[0][0] = 1;
        matrix.m[1][1] = 1;
        matrix.m[2][2] = 1;
        matrix.m[3][3] = 1;
        matrix.m[0][3] = x;
        matrix.m[1][3] = y;
        matrix.m[2][3] = z;
        return matrix;
    }

    static Scale(x, y, z) {
        let matrix = new Mat4x4();
        matrix.m[0][0] = x;
        matrix.m[1][1] = y;
        matrix.m[2][2] = z;
        matrix.m[3][3] = 1;
        return matrix;
    }

    static RotationX(angle) {
        let radian = angle / 180.0 * Math.PI;
        let matrix = new Mat4x4();
        matrix.m[0][0] = 1;
        matrix.m[1][1] = Math.cos(radian);
        matrix.m[1][2] = -Math.sin(radian);
        matrix.m[2][1] = Math.sin(radian);
        matrix.m[2][2] = Math.cos(radian);
        matrix.m[3][3] = 1;
        return matrix;
    }

    static RotationY(angle) {
        let radian = angle / 180.0 * Math.PI;
        let matrix = new Mat4x4();
        matrix.m[0][0] = Math.cos(radian);
        matrix.m[0][2] = -Math.sin(radian);
        matrix.m[1][1] = 1;
        matrix.m[2][0] = Math.sin(radian);
        matrix.m[2][2] = Math.cos(radian);
        matrix.m[3][3] = 1;
        return matrix;
    }

    static RotationZ(angle) {
        let radian = angle / 180.0 * Math.PI;
        let matrix = new Mat4x4();
        matrix.m[0][0] = Math.cos(radian);
        matrix.m[0][1] = -Math.sin(radian);
        matrix.m[1][0] = Math.sin(radian);
        matrix.m[1][1] = Math.cos(radian);
        matrix.m[2][2] = 1;
        matrix.m[3][3] = 1;
        return matrix;
    }
}
Mat4x4.Identity = new Mat4x4();
Mat4x4.Identity.m[0][0] = 1;
Mat4x4.Identity.m[1][1] = 1;
Mat4x4.Identity.m[2][2] = 1;
Mat4x4.Identity.m[3][3] = 1;</code></pre>

                    Tr∆∞·ªõc khi s·ª≠ d·ª•ng nh·ªØng ma tr·∫≠n n√†y, m√¨nh s·∫Ω n√≥i th√™m v·ªÅ c√°ch d√πng Model matrix. Gi·∫£ s·ª≠ n·∫øu b·∫°n mu·ªën di chuy·ªÉn m·ªôt v·∫≠t nhi·ªÅu l·∫ßn tr∆∞·ªõc khi
                    v·∫Ω (trong 1 frame) th√¨ sao, b·∫°n s·∫Ω kh√¥ng nh√¢n Translation matrix m·ªói l·∫ßn di chuy·ªÉn ƒë√¢u. C√°i b·∫°n c·∫ßn l√†m l√† thay ƒë·ªïi thu·ªôc t√≠nh v·ªã tr√≠ c·ªßa v·∫≠t bao nhi√™u l·∫ßn ƒë√≥, sau ƒë√≥ b·∫°n m·ªõi 
                    nh√¢n Translation ·ªü b∆∞·ªõc cu·ªëi c√πng, t∆∞∆°ng t·ª± ƒë·ªëi v·ªõi Rotation v√† Scale. V√† th·ª© t·ª± nh√¢n s·∫Ω l√† Scale -> Rotation -> Translation, th·∫≠t ra Scale v√† Rotation c√°i n√†o tr∆∞·ªõc c≈©ng ƒë∆∞·ª£c,
                    nh∆∞ng quan tr·ªçng l√† Translation ph·∫£i cu·ªëi c√πng, v√¨ n·∫øu b·∫°n di chuy·ªÉn xong m·ªõi xoay th√¨ n√≥ s·∫Ω xoay v·∫≠t quanh g·ªëc t·ªça ƒë·ªô ch·ª© ko xoay quanh ch√≠nh gi·ªØa c·ªßa v·∫≠t ƒë√¢u, t∆∞∆°ng t·ª± v·ªõi Scale,
                    n·∫øu b·∫°n di chuy·ªÉn xong m·ªõi scale th√¨ n√≥ s·∫Ω scale kh√¥ng gian ra t·ª´ g·ªëc t·ªça ƒë·ªô, ch·ª© ko scale ra t·ª´ ch√≠nh gi·ªØa v·∫≠t. Tr∆∞·ªõc khi di chuy·ªÉn v·∫≠t th√¨ ch√≠nh gi·ªØa c·ªßa v·∫≠t s·∫Ω tr√πng v·ªõi g·ªëc t·ªça ƒë·ªô,
                    Rotation v√† Scale s·∫Ω √°p d·ª•ng v·ªõi ch√≠nh gi·ªØa v·∫≠t. L√≠ do ta c·∫ßn ph·∫£i "t·ªïng h·ª£p bi·∫øn ƒë·ªïi trong 1 frame r·ªìi √°p d·ª•ng cho tr·∫°ng th√°i ban ƒë·∫ßu", l√† v√¨ th√¥ng
                    tin c·ªßa mesh (ƒë·ªânh, c·∫°nh, tam gi√°c, ...) l√† m·ªôt th√¥ng tin "c·ª©ng", ta lu√¥n ph·∫£i c√≥ ƒë∆∞·ª£c th√¥ng tin ƒë√≥ ƒë·ªÉ s·ª≠ d·ª•ng, ngo√†i ra m·ªôt l√≠ do kh√°c n·ªØa l√† n·∫øu b·∫°n li√™n t·ª•c
                    nh√¢n ma tr·∫≠n v√†o th√¨ sai s·ªë s·∫Ω c√†ng ng√†y c√†ng nhi·ªÅu (ƒë·∫∑c ƒëi·ªÉm c·ªßa float).<br/><br/>

                    V·ªÅ "t·ªïng h·ª£p bi·∫øn ƒë·ªïi" c·ªßa translation v√† scale kh√° ƒë∆°n gi·∫£n, b·∫°n ch·ªâ c·∫ßn l∆∞u thu·ªôc t√≠nh v·ªã tr√≠ v√† scale d∆∞·ªõi d·∫°ng Vector3, r·ªìi khi c·∫ßn (cu·ªëi frame) 
                    th√¨ t·∫°o th√†nh ma tr·∫≠n r·ªìi x√†i lu√¥n. Ri√™ng ƒë·ªëi v·ªõi Rotation l√† m·ªôt chuy·ªán kh√°c, n·∫øu b·∫°n nghƒ© l√† ch·ªâ c·∫ßn t·∫°o m·ªôt thu·ªôc t√≠nh Vector3 l∆∞u ƒë·ªô xoay c·ªßa v·∫≠t ·ªü 3 tr·ª•c,
                    r·ªìi nh√¢n rotation matrix t∆∞∆°ng ·ª©ng ·ªü cu·ªëi frame, th√¨ n√≥ s·∫Ω c√≥ kh√° nhi·ªÅu v·∫•n ƒë·ªÅ. V√≠ d·ª• 1 v·∫≠t l√∫c ƒë·∫ßu c√≥ rotation l√† (30, 0, 0),
                    trong 1 frame b·∫°n mu·ªën xoay m·ªôt v·∫≠t 45 ƒë·ªô ·ªü tr·ª•c Y, th√¨ b·∫°n c·ªông n√≥ v√¥ rotation l√† th√†nh (30, 45, 0), t·ª©c l√† t·ªïng h·ª£p bi·∫øn ƒë·ªïi l√† xoay X 30 ƒë·ªô, xong r·ªìi
                    xoay Y 45 ƒë·ªô, th√¨ th·∫≠t ra n√≥ v·∫´n hi·ªÉn th·ªã ƒë√∫ng. Tuy nhi√™n, n·∫øu l√∫c ƒë·∫ßu l√† (0, 30, 0), v√† xoay 45 ƒë·ªô ·ªü tr·ª•c X \(\rightarrow\) t·ªïng h·ª£p bi·∫øn ƒë·ªïi l√† xoay
                    Y 30 ƒë·ªô xong r·ªìi xoay X 45 ƒë·ªô, th√¨ ·ªü cu·ªëi frame b·∫°n th·ª±c hi·ªán ph√©p nh√¢n ma tr·∫≠n \(XYZ\) (m√¨nh ƒë√£ th·ªëng nh·∫•t ·ªü tr√™n) th√¨ n√≥ s·∫Ω xoay ki·ªÉu intrinsic ngay. Gi·∫£i ph√°p l√†
                    thay v√¨ l∆∞u rotation nh∆∞ m·ªôt Vector3, b·∫°n h√£y l∆∞u lu√¥n nguy√™n c√°i rotation matrix, c√≥ thay ƒë·ªïi g√¨ c·ª© nh√¢n th√™m v√†o n√≥ (nh√¢n v√†o ƒë·∫±ng tr∆∞·ªõc) l√† n√≥ s·∫Ω lu√¥n
                    extrinsic.<br/><br/>

                    Ti·∫øp theo, m√¨nh s·∫Ω t·∫°o m·ªôt Cube ƒë·ªÉ ƒë·∫°i di·ªán cho m·ªôt kh·ªëi l·∫≠p ph∆∞∆°ng c√≥ ƒë·∫ßy ƒë·ªß ƒë·∫∑c t√≠nh v·ªã tr√≠, ƒë·ªô xoay (ma tr·∫≠n) v√† t·ªâ l·ªá trong kh√¥ng gian, m√¨nh s·∫Ω chuy·ªÉn h√†m makeCube v√†o
                    trong class n√†y, ƒë·ªïi t√™n th√†nh generateInitialTriangles (c√°c tam gi√°c c·ªßa cube tr∆∞·ªõc khi ƒë∆∞·ª£c bi·∫øn ƒë·ªïi b·ªüi Model matrix). Ngo√†i ra t·∫°o th√™m m·ªôt h√†m getTransformedTriangles
                    ƒë·ªÉ tr·∫£ v·ªÅ nh·ªØng tam gi√°c ƒë√≥ sau khi b·ªã bi·∫øn ƒë·ªïi. ·ªû constructor th√¨ nh·∫≠n v√†o rotation ban ƒë·∫ßu (d∆∞·ªõi d·∫°ng 3 g√≥c ƒë·ªÉ d·ªÖ hi·ªÉu), √°p d·ª•ng n√≥ t·∫°o 3 rotation matrix v√† 
                    xoay ma tr·∫≠n ƒë∆°n v·ªã theo th·ª© t·ª± \(XYZ\) .
                    <pre><code class="language-javascript">class Cube {
    constructor(pos, rotation, scale) {
        this.tris = [];
        this.pos = pos;
        this.scale = scale;

        this.rotationMatrix = Mat4x4.Multiply(Mat4x4.RotationX(rotation.x), Mat4x4.Identity);
        this.rotateY(rotation.y);
        this.rotateZ(rotation.z);

        this.generateInitialTriangles();
    }

    generateInitialTriangles() {
        // FRONT
        this.tris.push(new Triangle([
            new Vector3(-0.5, -0.5, -0.5),
            new Vector3(-0.5, 0.5, -0.5),
            new Vector3(0.5, 0.5, -0.5)]));
        this.tris.push(new Triangle([
            new Vector3(-0.5, -0.5, -0.5),
            new Vector3(0.5, 0.5, -0.5),
            new Vector3(0.5, -0.5, -0.5)]));

        // RIGHT
        this.tris.push(new Triangle([
            new Vector3(0.5, -0.5, -0.5),
            new Vector3(0.5, 0.5, -0.5),
            new Vector3(0.5, 0.5, 0.5)]));

        this.tris.push(new Triangle([
            new Vector3(0.5, -0.5, -0.5),
            new Vector3(0.5, 0.5, 0.5),
            new Vector3(0.5, -0.5, 0.5)]));

        // BACK
        this.tris.push(new Triangle([
            new Vector3(0.5, -0.5, 0.5),
            new Vector3(0.5, 0.5, 0.5),
            new Vector3(-0.5, 0.5, 0.5)]));

        this.tris.push(new Triangle([
            new Vector3(0.5, -0.5, 0.5),
            new Vector3(-0.5, 0.5, 0.5),
            new Vector3(-0.5, -0.5, 0.5)]));

        // LEFT
        this.tris.push(new Triangle([
            new Vector3(-0.5, -0.5, 0.5),
            new Vector3(-0.5, 0.5, 0.5),
            new Vector3(-0.5, 0.5, -0.5)]));

        this.tris.push(new Triangle([
            new Vector3(-0.5, -0.5, 0.5),
            new Vector3(-0.5, 0.5, -0.5),
            new Vector3(-0.5, -0.5, -0.5)]));

        // TOP
        this.tris.push(new Triangle([
            new Vector3(-0.5, 0.5, -0.5),
            new Vector3(-0.5, 0.5, 0.5),
            new Vector3(0.5, 0.5, 0.5)]));

        this.tris.push(new Triangle([
            new Vector3(-0.5, 0.5, -0.5),
            new Vector3(0.5, 0.5, 0.5),
            new Vector3(0.5, 0.5, -0.5)]));

        // BOTTOM
        this.tris.push(new Triangle([
            new Vector3(0.5, -0.5, 0.5),
            new Vector3(-0.5, -0.5, 0.5),
            new Vector3(-0.5, -0.5, -0.5)]));

        this.tris.push(new Triangle([
            new Vector3(0.5, -0.5, 0.5),
            new Vector3(-0.5, -0.5, -0.5),
            new Vector3(0.5, -0.5, -0.5)]));
    }

    rotateX(angle) {
        this.rotationMatrix = Mat4x4.Multiply(Mat4x4.RotationX(angle), this.rotationMatrix);
    }
    rotateY(angle) {
        this.rotationMatrix = Mat4x4.Multiply(Mat4x4.RotationY(angle), this.rotationMatrix);
    }
    rotateZ(angle) {
        this.rotationMatrix = Mat4x4.Multiply(Mat4x4.RotationZ(angle), this.rotationMatrix);
    }

    getTransformedTriangles() {
        let transformedTris = [];
        for (let tri of this.tris) {
            let transformedTri = tri.clone();
            transformedTri.mulMat4x4(Mat4x4.Scale(this.scale.x, this.scale.y, this.scale.z));
            transformedTri.mulMat4x4(this.rotationMatrix);
            transformedTri.mulMat4x4(Mat4x4.Translation(this.pos.x, this.pos.y, this.pos.z));
            transformedTris.push(transformedTri);
        }
        return transformedTris;
    }
}</code></pre>

                    Class Triangle ch∆∞a c√≥ h√†m clone (clone lu√¥n ƒë·ªânh) v√† h√†m mulMat4x4 n√™n m√¨nh th√™m n√≥ v√†o (nh√¢n t·ª´ng ƒë·ªânh cho ma tr·∫≠n):
                    <pre><code class="language-javascript">class Triangle {
    ...

    clone() {
        let tri = new Triangle();
        for (let i = 0; i < this.vertices.length; i++)
            tri.vertices[i] = this.vertices[i].clone();
        return tri;
    }

    mulMat4x4(m) {
        for (let v of this.vertices) {
            v.mulMat4x4(m);
        }
    }
}</code></pre>
                    T·ªõi kh√∫c v·∫Ω ch√≠nh, m√¨nh s·∫Ω t·∫°o 2 cube, cube1 ·ªü v·ªã tr√≠ c≈© nh∆∞ng xoay tr·ª•c x 45 ƒë·ªô, cube2 l√∫c ƒë·∫ßu m√¨nh t·∫°o ·ªü x=1 nh∆∞ng sau ƒë√≥ m√¨nh tr·ª´ ƒëi 1.6, l√† cu·ªëi c√πng
                    n√≥ s·∫Ω ·ªü x=-0.6, l√† s·∫Ω ·ªü b√™n tr√°i m√†n h√¨nh.
                    <pre><code class="language-javascript">let cube1 = new Cube(new Vector3(0.6, -0.7, 2.5), new Vector3(45, 0, 0), new Vector3(0.7, 0.7, 0.7));
let cube2 = new Cube(new Vector3(1, 0, 2.5), new Vector3(0, 0, 15), new Vector3(1, 0.7, 0.7));
cube2.pos = Vector3.sub(cube2.pos, new Vector3(1.6, 0, 0));</code></pre>

                    Sau ƒë√≥ m√¨nh g·ªôp l·∫°i h·∫øt tam gi√°c (ƒë√£ ƒë∆∞·ª£c bi·∫øn ƒë·ªïi) c·ªßa 2 cube trong 1 m·∫£ng, v√† sau ƒë√≥ g·ªçi v√≤ng l·∫∑p for v·∫Ω t·ª´ng tam gi√°c nh∆∞ c≈©:
                    <pre><code class="language-javascript">let allTris = [];
allTris.push(...cube1.getTransformedTriangles());
allTris.push(...cube2.getTransformedTriangles());

for (let tri of allTris) {
    ...
}</code></pre>
                    Code full:
                    <div class="htmlPreview" id="htmlPreview9"></div>
                    <div id="graphics3D-nav-bottom"></div>
                </div>

            </div>
        </div>
    </main>

    <footer></footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script src="graphics3D.js"></script>
    <script src="/js/loadsidebar.js"></script>
</body>

</html>